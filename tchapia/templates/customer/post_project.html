{% extends 'partials/base.html' %}

{% block content %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Page Header -->
                <div class="text-center mb-5">
                    <h1 class="display-5 fw-bold text-success mb-3">
                        <i class="fas fa-plus-circle me-3"></i>Poster un Projet
                    </h1>
                    <p class="lead text-muted">
                        Décrivez votre projet et recevez des devis d'artisans qualifiés
                    </p>
                    <div class="bg-success mx-auto" style="width: 60px; height: 3px; border-radius: 2px;"></div>
                </div>

                <!-- Form Card -->
                <div class="card shadow border-0">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-edit me-2"></i>Détails du Projet
                        </h4>
                        <small>Remplissez tous les champs pour publier votre projet</small>
                    </div>

                    <div class="card-body p-4">
                        <!-- Messages -->
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}

                        <form method="post" enctype="multipart/form-data" novalidate>
                            {% csrf_token %}

                            <!-- Project Name -->
                            <div class="mb-4">
                                <label for="{{ form.name.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-project-diagram text-success me-2"></i>Nom du Projet
                                </label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.name.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Service Selection -->
                            <div class="mb-4">
                                <label for="{{ form.service.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-tools text-success me-2"></i>Type de Service
                                </label>
                                {{ form.service }}
                                {% if form.service.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.service.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="form-text text-muted">
                                    Les artisans de ce service seront notifiés
                                </small>
                            </div>

                            <!-- Description -->
                            <div class="mb-4">
                                <label for="{{ form.description.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-align-left text-success me-2"></i>Description Détaillée
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.description.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="form-text text-muted">
                                    Plus votre description est détaillée, mieux les artisans pourront vous proposer un devis précis
                                </small>
                            </div>

                            <!-- Project Images -->
                            <div class="mb-4">
                                <label for="{{ form.images.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-images text-success me-2"></i>Images du Projet (Optionnel)
                                </label>
                                {{ form.images }}
                                {% if form.images.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.images.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="form-text text-muted">
                                    {{ form.images.help_text }}
                                </small>

                                <!-- Preview area for selected images -->
                                <div id="imagePreview" class="mt-3 d-none">
                                    <label class="form-label small fw-semibold">Aperçu des images sélectionnées:</label>
                                    <div id="previewContainer" class="d-flex flex-wrap gap-2"></div>
                                </div>
                            </div>

                            <!-- Budget Range -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">
                                    <i class="fas fa-money-bill-wave text-success me-2"></i>Budget Estimé (XAF) - Optionnel
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="{{ form.budget_min.id_for_label }}" class="form-label small">Budget Minimum</label>
                                        {{ form.budget_min }}
                                        {% if form.budget_min.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form.budget_min.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        <label for="{{ form.budget_max.id_for_label }}" class="form-label small">Budget Maximum</label>
                                        {{ form.budget_max }}
                                        {% if form.budget_max.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form.budget_max.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% if form.non_field_errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Location -->
                            <div class="mb-4">
                                <label for="{{ form.location_address.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-map-marker-alt text-success me-2"></i>Adresse du Projet
                                </label>
                                {{ form.location_address }}
                                {% if form.location_address.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.location_address.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- City and Region -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="{{ form.city.id_for_label }}" class="form-label fw-semibold">
                                        <i class="fas fa-city text-success me-2"></i>Ville
                                    </label>
                                    {{ form.city }}
                                    {% if form.city.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.city.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <label for="{{ form.region.id_for_label }}" class="form-label fw-semibold">
                                        <i class="fas fa-globe text-success me-2"></i>Région
                                    </label>
                                    {{ form.region }}
                                    {% if form.region.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.region.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Priority and Deadline -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="{{ form.priority.id_for_label }}" class="form-label fw-semibold">
                                        <i class="fas fa-exclamation-triangle text-success me-2"></i>Priorité
                                    </label>
                                    {{ form.priority }}
                                    {% if form.priority.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.priority.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <label for="{{ form.deadline.id_for_label }}" class="form-label fw-semibold">
                                        <i class="fas fa-calendar text-success me-2"></i>Date Limite (Optionnel)
                                    </label>
                                    {{ form.deadline }}
                                    {% if form.deadline.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.deadline.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Submit Buttons -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <a href="{% url 'base:home' %}" class="btn btn-outline-secondary me-md-2">
                                            <i class="fas fa-times me-2"></i>Annuler
                                        </a>
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-paper-plane me-2"></i>Publier le Projet
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Card Footer with Info -->
                    <div class="card-footer bg-light">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <i class="fas fa-users text-success fa-2x mb-2"></i>
                                <p class="small mb-0"><strong>Artisans Notifiés</strong><br>Selon service et région</p>
                            </div>
                            <div class="col-md-4">
                                <i class="fas fa-shield-alt text-success fa-2x mb-2"></i>
                                <p class="small mb-0"><strong>Artisans Vérifiés</strong><br>Tous nos artisans sont qualifiés</p>
                            </div>
                            <div class="col-md-4">
                                <i class="fas fa-handshake text-success fa-2x mb-2"></i>
                                <p class="small mb-0"><strong>Devis Gratuits</strong><br>Comparez plusieurs propositions</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="mt-4 text-center">
                    <small class="text-muted">
                        <i class="fas fa-question-circle me-1"></i>
                        Besoin d'aide ? <a href="#" class="text-success">Contactez notre support</a>
                    </small>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Image preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.querySelector('input[type="file"][multiple]');
    if (imageInput) {
        imageInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const previewArea = document.getElementById('imagePreview');
            const previewContainer = document.getElementById('previewContainer');

            // Clear existing previews
            previewContainer.innerHTML = '';

            if (files.length > 0) {
                previewArea.classList.remove('d-none');

                files.forEach((file, index) => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const div = document.createElement('div');
                            div.className = 'position-relative';
                            div.innerHTML = `
                                <img src="${e.target.result}"
                                     class="img-thumbnail"
                                     style="width: 120px; height: 120px; object-fit: cover;"
                                     alt="Preview ${index + 1}">
                                <small class="d-block text-center mt-1 text-muted">${file.name}</small>
                            `;
                            previewContainer.appendChild(div);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                previewArea.classList.add('d-none');
            }
        });
    }
});
</script>

{% endblock content %}